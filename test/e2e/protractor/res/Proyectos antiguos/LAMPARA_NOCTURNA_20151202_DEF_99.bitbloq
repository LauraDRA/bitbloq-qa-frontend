{"code":"\n/***   Included libraries  ***/\n\n\n/***   Global variables and function definition  ***/\nint luzLampara = 3;int luzActivacion = 4;int sensorLuz = A1;int interruptor = 7;/*\nControla la cantidad de luz ambiente\n*/float valorLuz = 0;/*\nControla el estado de activacion de la lampara: 0 encendido-apagado; 1 apagado-encendido\n*/float controlActivacion = 0;/*\nControla si ha pasado ya todo el tiempo de encendido: 1 tiempo no agotado; 0 tiempo agotado.\n*/float timeout = 1;\n\n/***   Setup  ***/\nvoid setup(){pinMode(luzLampara, OUTPUT);pinMode(luzActivacion, OUTPUT);pinMode(sensorLuz, INPUT);pinMode(interruptor, INPUT);}\n\n/***   Loop  ***/\nvoid loop(){/*\nControl del estado de activacion de la lampara para saber si cuando se pulsa el boton pasamos de encendido a apagado o de apagado a encendido.\n*/if(digitalRead(7) == 1){/*\nEvita el efecto rebote del interruptor\n*/while (digitalRead(7) == 1){delay(100);}/*\nSi hemos pulsado el botón y la lampara estaba desactivada la activamos\n*/if(controlActivacion == 0){controlActivacion = 1;}/*\nSi hemos pulsado el botón y la lampara estaba activada, la desactivamos\n*/else {controlActivacion = 0;}}/*\nSi se ha pulsado el boton para activar la lampara\n*/if(controlActivacion == 1){/*\nActivamos la luz, encendemos el led de activacion\n*/digitalWrite(luzActivacion,HIGH);/*\nControlamos el encendido de la luz de la lampara con el  sensor de luz. Si es de noche,, la lampara se enciende. Si hay luz suficiente la lampara se apaga.\n*//*\nSi es de noche\n*/valorLuz = analogRead(A1);if(valorLuz < 200){if(timeout == 1){digitalWrite(luzLampara,HIGH);delay(2000);digitalWrite(luzLampara,LOW);/*\nSi se ha agotado el tiempo de encendido de la lampara pongo timeout=0\n*/timeout = 0;}}/*\nSi es de día\n*/else {digitalWrite(luzLampara,LOW);/*\nComo vuelve a ser de día, activo la variable que controla si se ha agotado o no el tiempo de encendido de la lampara para que la siguiente vez que se haga de noche vuelva a acivarse el tiempo de espera, por tanto timeout=1\n*/timeout = 1;}}/*\nSI la lampara se desactiva\n*/else {/*\nDesactivamos la lampara y apagamos la luz\n*/digitalWrite(luzActivacion,LOW);digitalWrite(luzLampara,LOW);}}","description":"","name":"LAMPARA_NOCTURNA_20151202_DEF","corbelId":"55acae7ae4b00f538d041f75:a39626c6-5533-44e6-8308-74ec6be9afdd","image":"default","userTags":[],"hardwareTags":["bq ZUM","led","ldrs","button"],"software":{"loop":{"content":[[]],"childs":[{"content":[[{"value":"Control del estado de activacion de la lampara para saber si cuando se pulsa el boton pasamos de encendido a apagado o de apagado a encendido.","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"bloqInputId":"ARG1","value":{"content":[[{"value":"interruptor","id":"SENSOR","alias":"dynamicDropdown"}]],"name":"readSensor","enable":true},"alias":"bloqInput"},{"value":"==","id":"OPERATOR","alias":"staticDropdown"},{"bloqInputId":"ARG2","value":{"content":[[{"value":"1","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"childs":[{"content":[[{"value":"Evita el efecto rebote del interruptor","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"bloqInputId":"ARG1","value":{"content":[[{"value":"interruptor","id":"SENSOR","alias":"dynamicDropdown"}]],"name":"readSensor","enable":true},"alias":"bloqInput"},{"value":"==","id":"OPERATOR","alias":"staticDropdown"},{"bloqInputId":"ARG2","value":{"content":[[{"value":"1","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"childs":[{"content":[[{"value":"100","id":"TIME","alias":"numberInput"}]],"name":"wait","enable":true}],"name":"while","enable":true},{"content":[[{"value":"Si hemos pulsado el botón y la lampara estaba desactivada la activamos","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"bloqInputId":"ARG1","value":{"content":[[{"value":"controlActivacion","id":"VAR","alias":"dynamicDropdown"}]],"name":"selectVariable","enable":true},"alias":"bloqInput"},{"value":"==","id":"OPERATOR","alias":"staticDropdown"},{"bloqInputId":"ARG2","value":{"content":[[{"value":"0","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"childs":[{"content":[[{"value":"controlActivacion","id":"NAME","alias":"dynamicDropdown"},{"bloqInputId":"VALUE","value":{"content":[[{"value":"1","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"name":"setVariable","enable":true}],"name":"if","enable":true},{"content":[[{"value":"Si hemos pulsado el botón y la lampara estaba activada, la desactivamos","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[]],"childs":[{"content":[[{"value":"controlActivacion","id":"NAME","alias":"dynamicDropdown"},{"bloqInputId":"VALUE","value":{"content":[[{"value":"0","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"name":"setVariable","enable":true}],"name":"else","enable":true}],"name":"if","enable":true},{"content":[[{"value":"Si se ha pulsado el boton para activar la lampara","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"bloqInputId":"ARG1","value":{"content":[[{"value":"controlActivacion","id":"VAR","alias":"dynamicDropdown"}]],"name":"selectVariable","enable":true},"alias":"bloqInput"},{"value":"==","id":"OPERATOR","alias":"staticDropdown"},{"bloqInputId":"ARG2","value":{"content":[[{"value":"1","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"childs":[{"content":[[{"value":"Activamos la luz, encendemos el led de activacion","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"value":"HIGH","id":"STATE","alias":"staticDropdown"},{"value":"luzActivacion","id":"LED","alias":"dynamicDropdown"}]],"name":"led","enable":true},{"content":[[{"value":"Controlamos el encendido de la luz de la lampara con el  sensor de luz. Si es de noche,, la lampara se enciende. Si hay luz suficiente la lampara se apaga.","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"value":"Si es de noche","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"value":"valorLuz","id":"NAME","alias":"dynamicDropdown"},{"bloqInputId":"VALUE","value":{"content":[[{"value":"sensorLuz","id":"SENSOR","alias":"dynamicDropdown"}]],"name":"readSensor","enable":true},"alias":"bloqInput"}]],"name":"setVariable","enable":true},{"content":[[{"bloqInputId":"ARG1","value":{"content":[[{"value":"valorLuz","id":"VAR","alias":"dynamicDropdown"}]],"name":"selectVariable","enable":true},"alias":"bloqInput"},{"value":"<","id":"OPERATOR","alias":"staticDropdown"},{"bloqInputId":"ARG2","value":{"content":[[{"value":"200","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"childs":[{"content":[[{"bloqInputId":"ARG1","value":{"content":[[{"value":"timeout","id":"VAR","alias":"dynamicDropdown"}]],"name":"selectVariable","enable":true},"alias":"bloqInput"},{"value":"==","id":"OPERATOR","alias":"staticDropdown"},{"bloqInputId":"ARG2","value":{"content":[[{"value":"1","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"childs":[{"content":[[{"value":"HIGH","id":"STATE","alias":"staticDropdown"},{"value":"luzLampara","id":"LED","alias":"dynamicDropdown"}]],"name":"led","enable":true},{"content":[[{"value":"2000","id":"TIME","alias":"numberInput"}]],"name":"wait","enable":true},{"content":[[{"value":"LOW","id":"STATE","alias":"staticDropdown"},{"value":"luzLampara","id":"LED","alias":"dynamicDropdown"}]],"name":"led","enable":true},{"content":[[{"value":"Si se ha agotado el tiempo de encendido de la lampara pongo timeout=0","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"value":"timeout","id":"NAME","alias":"dynamicDropdown"},{"bloqInputId":"VALUE","value":{"content":[[{"value":"0","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"name":"setVariable","enable":true}],"name":"if","enable":true}],"name":"if","enable":true},{"content":[[{"value":"Si es de día","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[]],"childs":[{"content":[[{"value":"LOW","id":"STATE","alias":"staticDropdown"},{"value":"luzLampara","id":"LED","alias":"dynamicDropdown"}]],"name":"led","enable":true},{"content":[[{"value":"Como vuelve a ser de día, activo la variable que controla si se ha agotado o no el tiempo de encendido de la lampara para que la siguiente vez que se haga de noche vuelva a acivarse el tiempo de espera, por tanto timeout=1","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"value":"timeout","id":"NAME","alias":"dynamicDropdown"},{"bloqInputId":"VALUE","value":{"content":[[{"value":"1","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"name":"setVariable","enable":true}],"name":"else","enable":true}],"name":"if","enable":true},{"content":[[{"value":"SI la lampara se desactiva","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[]],"childs":[{"content":[[{"value":"Desactivamos la lampara y apagamos la luz","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"value":"LOW","id":"STATE","alias":"staticDropdown"},{"value":"luzActivacion","id":"LED","alias":"dynamicDropdown"}]],"name":"led","enable":true},{"content":[[{"value":"LOW","id":"STATE","alias":"staticDropdown"},{"value":"luzLampara","id":"LED","alias":"dynamicDropdown"}]],"name":"led","enable":true}],"name":"else","enable":true}],"name":"loopBloq","enable":true},"setup":{"content":[[]],"childs":[],"name":"setupBloq","enable":true},"vars":{"content":[[]],"childs":[{"content":[[{"value":"Controla la cantidad de luz ambiente","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"value":"valorLuz","id":"NAME","alias":"varInput"},{"bloqInputId":"VALUE","value":{"content":[[{"value":"0","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"name":"declareVariable","enable":true},{"content":[[{"value":"Controla el estado de activacion de la lampara: 0 encendido-apagado; 1 apagado-encendido","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"value":"controlActivacion","id":"NAME","alias":"varInput"},{"bloqInputId":"VALUE","value":{"content":[[{"value":"0","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"name":"declareVariable","enable":true},{"content":[[{"value":"Controla si ha pasado ya todo el tiempo de encendido: 1 tiempo no agotado; 0 tiempo agotado.","id":"COMMENT","alias":"multilineCodeInput"}]],"name":"comment","enable":true},{"content":[[{"value":"timeout","id":"NAME","alias":"varInput"},{"bloqInputId":"VALUE","value":{"content":[[{"value":"1","id":"VALUE","alias":"numberInput"}]],"name":"number","enable":true},"alias":"bloqInput"}]],"name":"declareVariable","enable":true}],"name":"varsBloq","enable":true}},"hardware":{"board":"bq ZUM","connections":[{"pinSourceUid":"4cd35d1e-0bcc-4dab-9204-a984bf9c6b9c","pinTargetUid":"6be0dd9d-2e52-4b7d-9dfc-c9edad53bd10"},{"pinSourceUid":"19092052-b1fa-4fe8-90b8-16002880f425","pinTargetUid":"6be0dd9d-2e52-4b7d-9dfc-c9edad53ba04"},{"pinSourceUid":"47c531a3-dddb-4595-bbaa-81037c155cfb","pinTargetUid":"6be0dd9d-2e52-4b7d-9dfc-c9edad53bd06"},{"pinSourceUid":"100e828c-f83e-4821-bd02-2b0dd614a0c0","pinTargetUid":"6be0dd9d-2e52-4b7d-9dfc-c9edad53bd09"}],"components":[{"height":83,"category":"leds","id":"led","pins":{"digital":["s"]},"name":"luzLampara","coordinates":{"y":11.070998796630565,"x":70.08436080467229},"width":55,"icon":"LED","pin":{"s":"3"},"endpoints":{"s":{"type":"digital","uid":"4cd35d1e-0bcc-4dab-9204-a984bf9c6b9c"}},"uid":"138d0879-3dc7-453a-af72-cf79050248c7","connected":true},{"height":65,"category":"sensors","id":"ldrs","name":"sensorLuz","width":90,"pin":{"s":"A1"},"uid":"29558849-79a0-41b4-b6d8-eadb3dba9333","connected":true,"type":"analog","pins":{"analog":["s"]},"coordinates":{"y":81.5126050420168,"x":55.89318600368324},"icon":"LDR","endpoints":{"s":{"type":"analog","uid":"19092052-b1fa-4fe8-90b8-16002880f425"}}},{"height":73,"category":"sensors","id":"button","name":"interruptor","width":90,"pin":{"s":"7"},"uid":"c96d8bd0-13c1-4ff8-b9c3-ce40c8f8fd87","connected":true,"type":"digital","pins":{"digital":["s"]},"coordinates":{"y":7.3405535499398304,"x":34.45814406229721},"icon":"button","endpoints":{"s":{"type":"digital","uid":"47c531a3-dddb-4595-bbaa-81037c155cfb"}}},{"height":83,"category":"leds","id":"led","pins":{"digital":["s"]},"name":"luzActivacion","coordinates":{"y":6.738868832731648,"x":55.35366645035691},"width":55,"icon":"LED","pin":{"s":"4"},"endpoints":{"s":{"type":"digital","uid":"100e828c-f83e-4821-bd02-2b0dd614a0c0"}},"uid":"ac4b7003-06e7-465a-b78f-32b590546e6f","connected":true}]},"defaultTheme":"infotab_option_grayTheme","timesDownload":0,"timesAdded":0,"timesViewed":0}